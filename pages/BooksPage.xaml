<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="project.Pages.BooksPage"
             Title="Ma Bibliothèque"
             BackgroundColor="#F8F9FA">
    <Grid RowDefinitions="Auto, *, Auto" Padding="20" RowSpacing="10">

        <Border Grid.Row="0"
                StrokeShape="RoundRectangle 25"
                StrokeThickness="0"
                BackgroundColor="White"
                HeightRequest="50"
                Margin="0,0,0,10">
            <Border.Shadow>
                <Shadow Brush="Black" Offset="0,2" Radius="5" Opacity="0.1" />
            </Border.Shadow>

            <SearchBar x:Name="bookSearchBar"
                       Placeholder="Rechercher un livre..."
                       PlaceholderColor="#9E9E9E"
                       TextColor="#212121"
                       FontSize="15"
                       BackgroundColor="Transparent"
                       CancelButtonColor="#2196F3"
                       TextChanged="OnSearchTextChanged" />
        </Border>

        <CollectionView x:Name="BooksCollection" Grid.Row="1" Margin="10">
            <CollectionView.ItemsLayout>
                <GridItemsLayout Orientation="Vertical" 
                         Span="2" 
                         HorizontalItemSpacing="10" 
                         VerticalItemSpacing="10" />
            </CollectionView.ItemsLayout>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Border StrokeShape="RoundRectangle 15"
                    StrokeThickness="0"
                    BackgroundColor="White"
                    HeightRequest="220">
                        <Border.Shadow>
                            <Shadow Brush="Black" Offset="0,2" Radius="5" Opacity="0.1" />
                        </Border.Shadow>

                        <Grid RowDefinitions="Auto, *">
                            <Border Grid.Row="0" 
                            HeightRequest="120" 
                            StrokeShape="RoundRectangle 15,15,0,0"
                            BackgroundColor="#F0F0F0">
                                <Image Source="{Binding BookImage}" 
                               Aspect="AspectFill"
                               Margin="10"/>
                            </Border>

                            <VerticalStackLayout Grid.Row="1" Padding="10" Spacing="5">
                                <VerticalStackLayout.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnBookSelected" CommandParameter="{Binding .}" />
                                </VerticalStackLayout.GestureRecognizers>

                                <Label Text="{Binding Title}" 
                               FontSize="16" 
                               FontAttributes="Bold" 
                               MaxLines="1" 
                               LineBreakMode="TailTruncation"
                               TextColor="#2C3E50"/>

                                <Label Text="{Binding CategoryName}" 
                               FontSize="12" 
                               TextColor="#2196F3"/>

                                <Label Text="{Binding StatusName}" 
                               FontSize="11" 
                               TextColor="Gray"
                               FontAttributes="Italic"/>
                            </VerticalStackLayout>
                        </Grid>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <Button Grid.Row="2"
                Text="➕ Ajouter un Livre"
                Clicked="OnAddBookClicked"
                BackgroundColor="#2196F3"
                TextColor="White"
                FontAttributes="Bold"
                HeightRequest="55"
                CornerRadius="27"
                FontSize="16"
                Margin="0,10,0,5">
            <Button.Shadow>
                <Shadow Brush="#2196F3" Offset="0,4" Radius="10" Opacity="0.3" />
            </Button.Shadow>
        </Button>
    </Grid>
</ContentPage>